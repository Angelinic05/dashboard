<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perfect Launch</title>
    <link rel="stylesheet" href="ventas.css">
    <link rel="icon" type="image/png" href="../logo.png">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
    <script src="Main.js" defer></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link href='//fonts.googleapis.com/css?family=Montserrat:thin,extra-light,light,100,200,300,400,500,600,700,800' rel='stylesheet' type='text/css'>
    <style>
        body {
            font-family: 'Montserrat';
        }
    </style>
</head>
<body>
  <div class="sidebar close">
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus'></i>
      <span class="logo_name">Dashboard</span>
    </div>
    <ul class="nav-links">
      <li>
        <a href="../Index.html">
          <i class='bx bx-grid-alt' ></i>
          <span class="link_name">Dashboard</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Dashboard</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class='bx bxs-rocket' ></i>
            <span class="link_name">Lanzamientos</span>
          </a>
        </div>

      </li>
      <li>
        <div class="iocn-link">
          <a href="../comparativa/comparativa.html">
            <i class='bx bx-bar-chart-alt-2' ></i>
            <span class="link_name">Comparativa</span>
          </a>
          
        </div>

      </li>
      <!-- <li>
        <a href="../ventas/ventas.html">
          <i class='bx bx-pie-chart-alt-2' ></i>
          <span class="link_name">Lanzamientos</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Analytics</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-line-chart' ></i>
          <span class="link_name">Chart</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Chart</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="ventas/ventas.html">
            <i class='bx bx-collection' ></i>
            <span class="link_name">Lanzamientos</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Lanzamientos</a></li>
          <li><a href="#">Enero</a></li>
          <li><a href="#">Abril</a></li>
          <li><a href="#">Julio</a></li>
          <li><a href="../Index.html">Septiembre</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-compass' ></i>
          <span class="link_name">Explore</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Explore</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-history'></i>
          <span class="link_name">History</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">History</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-cog' ></i>
          <span class="link_name">Setting</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Setting</a></li>
        </ul>
      </li> -->
      <li>
    <div class="profile-details">
      <div class="profile-content">
        <!--<img src="image/profile.jpg" alt="profileImg">-->
      </div>
      <div class="name-job">
        <div class="profile_name">Prem Shahi</div>
        <div class="job">Web Desginer</div>
      </div>
      <i class='bx bx-log-out' ></i>
    </div>
  </li>
</ul>
  </div>
  <section class="home-section">
    <div class="home-content">
        <i class='bx bx-menu'></i>
        <!-- <img src="" alt="Logo"> -->
    </div>
</section>

<div class="contenedor-principal">
  <!-- Fila superior con 4 contenedores -->
  <div class="fila-superior2">
      <div id="enero" class="contenedor-pequeño2">
          <div class="statnum2">ENERO</div>
      </div>
      <div id="abril" class="contenedor-pequeño2">
          <div class="statnum2">ABRIL</div>
      </div>
      <div id="julio" class="contenedor-pequeño2">
          <div class="statnum2">JULIO</div>
      </div>
      <div id="septiembre" class="contenedor-pequeño2">
          <div class="statnum2">SEPT</div>
      </div>
  </div>

  <!-- Contenedor para gráficos de barras y tortas -->
  <div class="contenedor-centro">
      <div class="grafico" id="barChart">Cargando...</div>
      <div class="grafico" id="pieChart">Cargando...</div>
      <!-- <div id="calendar" class="otro"></div> -->
  </div>

  <!-- Contenedor separado para el diagrama lineal -->
  <div class="grafico-lineal" id="lineChart">Cargando...</div>




  <!-- <div id="salesTables"></div> -->
  





    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.js'></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://kit.fontawesome.com/e267099c50.js" crossorigin="anonymous"></script>

    <script>
        let arrow = document.querySelectorAll(".arrow");
        arrow.forEach((arrowElement) => {
            arrowElement.addEventListener("click", (e) => {
                let arrowParent = e.target.parentElement.parentElement; // selecciona el padre principal de la flecha
                arrowParent.classList.toggle("showMenu");
            });
        });

        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".bx-menu");
        sidebarBtn.addEventListener("click", () => {
            sidebar.classList.toggle("close");
        });
        // --------------------------------------------------------------------------------------

// --------------------------------------------------------------------------------

        document.addEventListener('DOMContentLoaded', function () {

    const url = 'https://script.google.com/macros/s/AKfycbyEKcO_o0uHWrjTDx33whPQ3xP_-CKgLuAWeIBIRMlKRQQCq6aiR0GmNVuoaydwRf0MQQ/exec';

    async function fetchData() {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Error en la solicitud: ' + response.statusText);
            }
            const data = await response.json();
            console.log('Datos obtenidos:', data);
            createCharts(data.graficas);
        } catch (error) {
            console.error('Error al obtener los datos:', error);
        }
    }

    function createCharts(combinedValues) {

      const salesData = combinedValues.slice(0, combinedValues.length);
        const salesByMonth = {
            enero: combinedValues.map(row => row[1]),
            abril: combinedValues.map(row => row[2]),
            julio: combinedValues.map(row => row[3]),
            septiembre: combinedValues.map(row => row[4])
        };

        // const barTotals = Object.values(salesByMonth).map(sales => sales.reduce((sum, val) => sum + val, 0));
        const barTotals = Object.values(salesByMonth).map(sales => {
        const salesToSum = sales.slice(0, sales.length - 2);  
        return salesToSum.reduce((sum, val) => sum + val, 0);
        });

        const screenWidth = window.innerWidth;
        const fontSize = screenWidth < 768 ? 7 : 17;
        const barWidth = screenWidth < 768 ? 20 : 50;
        const labelFontSize = screenWidth < 768 ? 10 : 15;
        const widthLine = screenWidth < 768 ? 2 : 6;

        // Inicializar gráfico de barras
        const barChart = echarts.init(document.getElementById('barChart'));
        const barOption = createBarChartOption(barTotals, fontSize, barWidth, labelFontSize);
        barChart.setOption(barOption);

        // Inicializar gráfico lineal
        const lineChart = echarts.init(document.getElementById('lineChart'));
        const lineOption = createLineChartOption(combinedValues, salesByMonth, fontSize, widthLine);
        lineChart.setOption(lineOption);

        // Inicializar gráfico de torta
        createPieChart(combinedValues, 'julio'); // Muestra el gráfico de torta para enero por defecto

        window.addEventListener('resize', () => {
            barChart.resize();
            lineChart.resize();
            createPieChart(salesData, highlightedMonth);
        });

        let highlightedMonth = 'enero'; // Mantiene el mes resaltado

        function highlightMonth(month) {
            const colors = ['#ff32c8', '#6657ff', '#3ab1f5', '#67f213'];
            const fadedColor = 'rgba(28,59,137,0.5)';
            const monthIndex = ['enero', 'abril', 'julio', 'septiembre'].indexOf(month);

            if (highlightedMonth === month) {
                highlightedMonth = 'enero'; // Resaltar a enero si el mismo mes se hace clic
                resetHighlighting(barOption, lineOption, colors);
                createPieChart(salesData, highlightedMonth); // Regresa a enero
                console.log("activador")
                console.log(highlightMonth); //
                console.log(salesData); //
            } else {
                highlightedMonth = month;
                applyHighlighting(barOption, lineOption, monthIndex, colors, fadedColor);
                createPieChart(salesData, highlightedMonth); // Actualiza gráfico de torta para el mes resaltado
            }
            barChart.setOption(barOption);
            lineChart.setOption(lineOption);
        }

        ['enero', 'abril', 'julio', 'septiembre'].forEach(month => {
            document.getElementById(month).addEventListener('click', () => highlightMonth(month));
        });
    }

    const solidColors = ['#ff32c8', '#6657ff', '#3ab1f5', '#67f213'];
const solidColors2 = ['#e17080', '#b745fd', '#38e3bf', '#a8ed20'];

    function createBarChartOption(barTotals, fontSize, barWidth, labelFontSize) {
    return {
        tooltip: {},
        xAxis: {
            type: 'category',
            data: ['ENERO', 'ABRIL', 'JULIO', 'SEPT'],
            axisLabel: { color: 'white', fontSize: fontSize }
        },
        yAxis: {
            type: 'value',
            axisLabel: { color: 'white', fontSize: fontSize },
            splitLine: { lineStyle: { color: '#11375e', width: 3 } }
        },
        series: [{
            name: 'Ventas',
            type: 'bar',
            data: barTotals,
            itemStyle: {
                color: function (params) {
                    const colors = solidColors.map((color, index) => {
                        return {
                            colorStops: [
                                { offset: 0, color: solidColors[index] },
                                { offset: 1, color: solidColors2[index] }
                            ],
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                        };
                    });
                    return colors[params.dataIndex];
                },
                borderRadius: [10, 10, 0, 0],
                shadowBlur: 10,
                shadowColor: function (params) {
                    const shadowColors = ['#ff32c8', '#6657ff', '#3ab1f5', '#67f213'];
                    return shadowColors[params.dataIndex];
                },
                shadowOffsetX: 5,
                shadowOffsetY: 5,
                emphasis: {
                    shadowBlur: 30,
                    shadowColor: '#11375e'
                }
            },
            label: {
                show: true,
                position: 'top',
                color: '#ffffff',
                fontSize: labelFontSize,
                fontWeight: 'bold',
                textShadowColor: '#000',
                textShadowBlur: 10
            },
            barWidth: barWidth,
            animationDelay: function (idx) {
                return idx * 200;
            }
        }],
        animationEasing: 'elasticOut',
        animationDuration: 2000
    };
}

    function createLineChartOption(combinedValues, salesByMonth, fontSize, widthLine) {
      const xAxisData = combinedValues.slice(0, combinedValues.length - 2).map(row => row[0]); // Excluye CONTADO y CRÉDITO
      const dataEnero = salesByMonth.enero.slice(0, salesByMonth.enero.length - 2);
      const dataAbril = salesByMonth.abril.slice(0, salesByMonth.abril.length - 2);
      const dataJulio = salesByMonth.julio.slice(0, salesByMonth.julio.length - 2);
      const dataSeptiembre = salesByMonth.septiembre.slice(0, salesByMonth.septiembre.length - 2);

    return {
        tooltip: { trigger: 'axis' },
        legend: {
            data: ['Enero', 'Abril', 'Julio', 'Septiembre'],
            textStyle: { color: 'white', fontSize: fontSize }
        },
        xAxis: {
            type: 'category',
            data: xAxisData, // Eje X ajustado
            axisLabel: { color: 'white', fontSize: fontSize }
        },
        yAxis: {
            type: 'value',
            axisLabel: { color: 'white', fontSize: fontSize },
            splitLine: { lineStyle: { color: '#11375e', width: 3 } }
        },
        series: [
            { name: 'Enero', type: 'line', data: dataEnero, lineStyle: { color: '#BF00B9', width: widthLine, shadowColor: '#FF00F7', shadowBlur: 10 }, itemStyle: { color: '#FF00F7' } },
            { name: 'Abril', type: 'line', data: dataAbril, lineStyle: { color: '#6657ff', width: widthLine, shadowColor: '#6657ff', shadowBlur: 10 }, itemStyle: { color: '#6657ff' } },
            { name: 'Julio', type: 'line', data: dataJulio, lineStyle: { color: '#3ab1f5', width: widthLine, shadowColor: '#3ab1f5', shadowBlur: 10 }, itemStyle: { color: '#3ab1f5' } },
            { name: 'Septiembre', type: 'line', data: dataSeptiembre, lineStyle: { color: '#49E000', width: widthLine, shadowColor: '#49E000', shadowBlur: 10 }, itemStyle: { color: '#49E000' } }
        ],
        animationEasing: 'elasticOut',
        animationDuration: 1500
    };
}
    function createPieChart(combinedValues, month, fontSize) {
      console.log("datos para tarta" + combinedValues)
    const monthMap = {
        enero: 1,
        abril: 2,
        julio: 3,
        septiembre: 4
    };
    const selectedMonthIndex = monthMap[month];

    // Obtener los valores de CONTADO y CRÉDITO según el mes seleccionado
    const contado = combinedValues[combinedValues.length - 2][selectedMonthIndex]; // Valor de CONTADO
    const credito = combinedValues[combinedValues.length - 1][selectedMonthIndex]; // Valor de CRÉDITO
    console.log("aqui")
    console.log(contado)
    console.log(credito)

    const pieData = [
        { value: contado, name: 'CONTADO' },
        { value: credito, name: 'CRÉDITO' }
    ];

    // Mapeo de colores por mes
    const colorMap = {
        enero: ['#ff32c8', '#e17080'], // Colores para enero
        abril: ['#6657ff', '#b745fd'],  // Colores para abril
        julio: ['#3ab1f5', '#38e3bf'],   // Colores para julio
        septiembre: ['#67f213', '#a8ed20'] // Colores para septiembre
    };

    const selectedColors = colorMap[month];

    const pieChart = echarts.init(document.getElementById('pieChart'));
    const pieOption = {
        tooltip: {
            trigger: 'item'
        },
        legend: {
            orient: 'vertical',
            left: 'left',
            textStyle: { color: 'white' },
            fontSize: fontSize
        },
        series: [{
            name: 'Tipo de Venta',
            type: 'pie',
            data: pieData,
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            },
            itemStyle: {
                borderRadius: 0,
                borderWidth: 2,
                color: function (params) {
                    return selectedColors[params.dataIndex]; // Asignar colores según el mes
                }
            },
            label: {
                show: true,
                position: 'inside', // Colocar etiquetas dentro de la torta
                formatter: '{b}: {c}', // Muestra el nombre y el valor
                color: '#fff' // Color del texto
            }
        }],
        animation: true,
        animationDuration: 1500
    };

    pieChart.setOption(pieOption);
}


    function resetHighlighting(barOption, lineOption, colors) {
        barOption.series[0].itemStyle.color = function (params) {
            return colors[params.dataIndex]; // Reestablecer color original
        };
        lineOption.series.forEach((series, index) => {
            series.lineStyle.color = colors[index]; // Reestablecer color original
        });
    }

    function applyHighlighting(barOption, lineOption, monthIndex, colors, fadedColor) {
        barOption.series[0].itemStyle.color = function (params) {
            return params.dataIndex === monthIndex ? colors[params.dataIndex] : fadedColor; // Resaltar mes seleccionado
        };
        lineOption.series.forEach((series, index) => {
            series.lineStyle.color = index === monthIndex ? colors[index] : fadedColor; // Resaltar mes seleccionado
        });
    }

    fetchData();
});





    </script>
</body>
</html>
