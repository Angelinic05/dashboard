<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perfect Launch</title>
    <link rel="stylesheet" href="ventas.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="Main.js" defer></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link href='//fonts.googleapis.com/css?family=Montserrat:thin,extra-light,light,100,200,300,400,500,600,700,800' rel='stylesheet' type='text/css'>
    <style>
        body {
            font-family: 'Montserrat';
        }
    </style>
</head>
<body>
  <div class="sidebar close">
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus'></i>
      <span class="logo_name">Dashboard</span>
    </div>
    <ul class="nav-links">
      <li>
        <a href="../Index.html">
          <i class='bx bx-grid-alt' ></i>
          <span class="link_name">Dashboard</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Dashboard</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class='bx bx-collection' ></i>
            <span class="link_name">Comparativa</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Lanzamientos</a></li>
          <li><a href="#" >Enero</a></li>
          <li><a href="#" >Abril</a></li>
          <li><a href="#" >Julio</a></li>
          <li><a href="#" >Septiembre</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class='bx bx-book-alt' ></i>
            <span class="link_name">Posts</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Posts</a></li>
          <li><a href="#">Web Design</a></li>
          <li><a href="#">Login Form</a></li>
          <li><a href="#">Card Design</a></li>
        </ul>
      </li>
      <li>
        <a href="../ventas/ventas.html">
          <i class='bx bx-pie-chart-alt-2' ></i>
          <span class="link_name">Lanzamientos</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Analytics</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-line-chart' ></i>
          <span class="link_name">Chart</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Chart</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="ventas/ventas.html">
            <i class='bx bx-collection' ></i>
            <span class="link_name">Lanzamientos</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Lanzamientos</a></li>
          <li><a href="#">Enero</a></li>
          <li><a href="#">Abril</a></li>
          <li><a href="#">Julio</a></li>
          <li><a href="../Index.html">Septiembre</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-compass' ></i>
          <span class="link_name">Explore</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Explore</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-history'></i>
          <span class="link_name">History</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">History</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-cog' ></i>
          <span class="link_name">Setting</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Setting</a></li>
        </ul>
      </li>
      <li>
    <div class="profile-details">
      <div class="profile-content">
        <!--<img src="image/profile.jpg" alt="profileImg">-->
      </div>
      <div class="name-job">
        <div class="profile_name">Prem Shahi</div>
        <div class="job">Web Desginer</div>
      </div>
      <i class='bx bx-log-out' ></i>
    </div>
  </li>
</ul>
  </div>
  <section class="home-section">
    <div class="home-content">
        <i class='bx bx-menu'></i>
        <img src="logo.png" alt="Logo"><!-- Agregar texto relevante -->
    </div>
</section>

<div class="contenedor-principal">
  <!-- Fila superior con 4 contenedores -->
  <div class="fila-superior2">
      <div id="enero" class="contenedor-pequeño2">
              <div class="statnum2">ENERO</div>
      </div>
      <div id="abril" class="contenedor-pequeño2">
              <div class="statnum2">ABRIL</div>
      </div>
      <div id="julio" class="contenedor-pequeño2">
              <div class="statnum2">JULIO</div>
      </div>
      <div id="septiembre" class="contenedor-pequeño2">
              <div class="statnum2">SEPT</div>
      </div>
  </div>


  <div class="contenedor-centro">
      <div id="barChart" ></div>
      <div id="lineChart" ></div>
      <div id="pieChartContainer"></div>
  </div>

  <!-- <div id="salesTables"></div> -->
  





    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://kit.fontawesome.com/e267099c50.js" crossorigin="anonymous"></script>

    <script>
        let arrow = document.querySelectorAll(".arrow");
        arrow.forEach((arrowElement) => {
            arrowElement.addEventListener("click", (e) => {
                let arrowParent = e.target.parentElement.parentElement; // selecciona el padre principal de la flecha
                arrowParent.classList.toggle("showMenu");
            });
        });

        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".bx-menu");
        sidebarBtn.addEventListener("click", () => {
            sidebar.classList.toggle("close");
        });

        document.addEventListener('DOMContentLoaded', function () {
    const url = 'https://script.google.com/macros/s/AKfycbyEKcO_o0uHWrjTDx33whPQ3xP_-CKgLuAWeIBIRMlKRQQCq6aiR0GmNVuoaydwRf0MQQ/exec';

    async function fetchData() {
        try {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Error en la solicitud: ' + response.statusText);
            }
            const data = await response.json();
            console.log('Datos obtenidos:', data);
            createCharts(data.graficas);
        } catch (error) {
            console.error('Error al obtener los datos:', error);
        }
    }

    function createCharts(combinedValues) {
        const salesByMonth = {
            enero: combinedValues.map(row => row[1]),
            abril: combinedValues.map(row => row[2]),
            julio: combinedValues.map(row => row[3]),
            septiembre: combinedValues.map(row => row[4])
        };

        const barTotals = Object.values(salesByMonth).map(sales => sales.reduce((sum, val) => sum + val, 0));

        const screenWidth = window.innerWidth;
        const fontSize = screenWidth < 768 ? 9 : 17;
        const barWidth = screenWidth < 768 ? 30 : 50;
        const labelFontSize = screenWidth < 768 ? 10 : 15;
        const widthLine = screenWidth < 768 ? 2 : 6;

        // Inicializar gráfico de barras
        const barChart = echarts.init(document.getElementById('barChart'));
        const barOption = createBarChartOption(barTotals, fontSize, barWidth, labelFontSize);
        barChart.setOption(barOption);

        // Inicializar gráfico lineal
        const lineChart = echarts.init(document.getElementById('lineChart'));
        const lineOption = createLineChartOption(combinedValues, salesByMonth, fontSize, widthLine);
        lineChart.setOption(lineOption);

        window.addEventListener('resize', () => {
            barChart.resize();
            lineChart.resize();
        });

        let highlightedIndex = -1;

        function highlightMonth(index) {
            const colors = ['#EEB84C', '#D474C7', '#13C3E9', '#90EE90'];
            const fadedColor = 'rgba(28,59,137,0.5)';

            if (highlightedIndex === index) {
                highlightedIndex = -1;
                resetHighlighting(barOption, lineOption, colors);
            } else {
                highlightedIndex = index;
                applyHighlighting(barOption, lineOption, index, colors, fadedColor);
                createPieChart(combinedValues, index);
            }
            barChart.setOption(barOption);
            lineChart.setOption(lineOption);
        }

        ['enero', 'abril', 'julio', 'septiembre'].forEach((month, index) => {
            document.getElementById(month).addEventListener('click', () => highlightMonth(index));
        });
    }

    function createBarChartOption(barTotals, fontSize, barWidth, labelFontSize) {
        return {
            tooltip: {},
            xAxis: {
                type: 'category',
                data: ['ENERO', 'ABRIL', 'JULIO', 'SEPT'],
                axisLabel: { color: 'white', fontSize: fontSize }
            },
            yAxis: {
                type: 'value',
                axisLabel: { color: 'white', fontSize: fontSize },
                splitLine: { lineStyle: { color: '#070707', width: 3 } }
            },
            series: [{
                name: 'Ventas',
                type: 'bar',
                data: barTotals,
                itemStyle: {
                    color: function (params) {
                        const colors = ['#EEB84C', '#D474C7', '#13C3E9', '#90EE90'];
                        return colors[params.dataIndex];
                    },
                    borderRadius: [10, 10, 0, 0],
                    shadowBlur: 10,
                    shadowColor: 'rgba(0, 0, 0, 0.8)',
                    shadowOffsetX: 5,
                    shadowOffsetY: 5,
                },
                label: {
                    show: true,
                    position: 'top',
                    color: '#ffffff',
                    fontSize: labelFontSize,
                    fontWeight: 'bold',
                    textShadowColor: '#000',
                    textShadowBlur: 5
                },
                barWidth: barWidth,
                animationDelay: function (idx) {
                    return idx * 200;
                }
            }],
            animationEasing: 'elasticOut',
            animationDuration: 2000
        };
    }

    function createLineChartOption(combinedValues, salesByMonth, fontSize, widthLine) {
        return {
            tooltip: { trigger: 'axis' },
            legend: {
                data: ['Enero', 'Abril', 'Julio', 'Septiembre'],
                textStyle: { color: 'white', fontSize: fontSize }
            },
            xAxis: {
                type: 'category',
                data: combinedValues.map(row => row[0]),
                axisLabel: { color: 'white', fontSize: fontSize }
            },
            yAxis: {
                type: 'value',
                axisLabel: { color: 'white', fontSize: fontSize },
                splitLine: { lineStyle: {  color: '#070707', width: 3 } }
            },
            series: [
                { name: 'Enero', type: 'line', data: salesByMonth.enero, lineStyle: { color: '#EEB84C', width: widthLine }, itemStyle: { color: '#EEB84C' } },
                { name: 'Abril', type: 'line', data: salesByMonth.abril, lineStyle: { color: '#D474C7', width: widthLine }, itemStyle: { color: '#D474C7' } },
                { name: 'Julio', type: 'line', data: salesByMonth.julio, lineStyle: { color: '#13C3E9', width: widthLine }, itemStyle: { color: '#13C3E9' } },
                { name: 'Septiembre', type: 'line', data: salesByMonth.septiembre, lineStyle: { color: '#90EE90', width: widthLine }, itemStyle: { color: '#90EE90' } }
            ],
            animationEasing: 'elasticOut',
            animationDuration: 1500
        };
    }

    function resetHighlighting(barOption, lineOption, colors) {
        barOption.series[0].itemStyle.color = function (params) {
            return colors[params.dataIndex];
        };
        lineOption.series.forEach((serie, i) => {
            serie.lineStyle.color = colors[i];
        });
    }

    function applyHighlighting(barOption, lineOption, index, colors, fadedColor) {
        barOption.series[0].itemStyle.color = function (params) {
            return params.dataIndex === index ? colors[params.dataIndex] : fadedColor;
        };
        lineOption.series.forEach((serie, i) => {
            serie.lineStyle.color = i === index ? colors[i] : fadedColor;
        });
    }
    function createPieChart(data, monthIndex) {
    const canvasContainer = document.getElementById('pieChartContainer');
    canvasContainer.innerHTML = ''; // Limpiar contenido anterior

    const contado = data[monthIndex][1];
    const credito = data[monthIndex][2];

    const pieChartCanvas = document.createElement('canvas');
    canvasContainer.appendChild(pieChartCanvas);

    const pieChart = echarts.init(pieChartCanvas);
    const total = contado + credito;

    // Colores para cada mes y sus tonos más oscuros
    const colors = [
        { contado: '#EEB84C', credito: '#BFA640' }, // Enero
        { contado: '#D474C7', credito: '#A85B9D' }, // Abril
        { contado: '#13C3E9', credito: '#0FA1B6' }, // Julio
        { contado: '#90EE90', credito: '#74B974' }  // Septiembre
    ];
    
    const option = {
        title: {
            text: `Ventas ${['Enero', 'Abril', 'Julio', 'Septiembre'][monthIndex]}`,
            left: 'center',
            top: 'top',
            textStyle: {
                color: 'white'
            }
        },
        tooltip: {
            trigger: 'item',
            formatter: (params) => {
                const percent = ((params.data.value / total) * 100).toFixed(2);
                return `${params.data.name}: ${params.data.value} (${percent}%)`;
            }
        },
        series: [{
            name: 'Ventas',
            type: 'pie',
            radius: '100%', // Aumentar el tamaño de la torta
            data: [
                { value: contado, name: 'Contado', itemStyle: { color: colors[monthIndex].contado } }, // Color para "Contado"
                { value: credito, name: 'Crédito', itemStyle: { color: colors[monthIndex].credito } } // Color más oscuro para "Crédito"
            ],
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            },
            label: {
                show: true,
                position: 'center', // Mostrar en el centro
                formatter: function(params) {
                    return `${params.data.name}\n${params.data.value}\n${((params.data.value / total) * 100).toFixed(2)}%`;
                },
                color: '#ffffff', // Color de texto
                fontSize: 16,
                fontWeight: 'bold'
            }
        }],
        animationType: 'scale',
        animationEasing: 'elasticOut',
        animationDelay: (idx) => idx * 100
    };

    pieChart.setOption(option);



    // Hacer que el gráfico sea responsivo
    window.addEventListener('resize', function() {
        pieChart.resize();
    });
}


// Llamada para obtener datos
fetchData();


});




    </script>
</body>
</html>
