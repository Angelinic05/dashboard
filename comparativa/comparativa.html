<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Perfect Launch</title>
    <link rel="stylesheet" href="comparativa.css">
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css' rel='stylesheet' />
    <script src="Main.js" defer></script>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link href='//fonts.googleapis.com/css?family=Montserrat:thin,extra-light,light,100,200,300,400,500,600,700,800' rel='stylesheet' type='text/css'>
    <style>
        body {
            font-family: 'Montserrat';
        }
    </style>
</head>
<body>
  <div class="sidebar close">
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus'></i>
      <span class="logo_name">Dashboard</span>
    </div>
    <ul class="nav-links">
      <li>
        <a href="../Index.html">
          <i class='bx bx-grid-alt' ></i>
          <span class="link_name">Dashboard</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Dashboard</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="../ventas/ventas.html">
            <i class='bx bxs-rocket' ></i>
            <span class="link_name">Lanzamientos</span>
          </a>
        </div>

      </li>
      <li>
        <div class="iocn-link">
          <a href="#">
            <i class='bx bx-bar-chart-alt-2' ></i>
            <span class="link_name">Comparativa</span>
          </a>
        </div>

      </li>
      <!-- <li>
        <a href="../ventas/ventas.html">
          <i class='bx bx-pie-chart-alt-2' ></i>
          <span class="link_name">Lanzamientos</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Analytics</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-line-chart' ></i>
          <span class="link_name">Chart</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Chart</a></li>
        </ul>
      </li>
      <li>
        <div class="iocn-link">
          <a href="ventas/ventas.html">
            <i class='bx bx-collection' ></i>
            <span class="link_name">Lanzamientos</span>
          </a>
          <i class='bx bxs-chevron-down arrow' ></i>
        </div>
        <ul class="sub-menu">
          <li><a class="link_name" href="#">Lanzamientos</a></li>
          <li><a href="#">Enero</a></li>
          <li><a href="#">Abril</a></li>
          <li><a href="#">Julio</a></li>
          <li><a href="../Index.html">Septiembre</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-compass' ></i>
          <span class="link_name">Explore</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Explore</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-history'></i>
          <span class="link_name">History</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">History</a></li>
        </ul>
      </li>
      <li>
        <a href="#">
          <i class='bx bx-cog' ></i>
          <span class="link_name">Setting</span>
        </a>
        <ul class="sub-menu blank">
          <li><a class="link_name" href="#">Setting</a></li>
        </ul>
      </li> -->
      <li>
    <div class="profile-details">
      <div class="profile-content">
        <!--<img src="image/profile.jpg" alt="profileImg">-->
      </div>
      <div class="name-job">
        <div class="profile_name">Prem Shahi</div>
        <div class="job">Web Desginer</div>
      </div>
      <i class='bx bx-log-out' ></i>
    </div>
  </li>
</ul>
  </div>
  <section class="home-section">
    <div class="home-content">
        <i class='bx bx-menu'></i>
        <!-- <img src="" alt="Logo"> -->
    </div>
</section>


<div class="contenedor-principal">
  <!-- Primera fila con 4 contenedores pequeños -->
  

  <!-- Segunda fila con 2 contenedores grandes -->
  <div class="fila">
      <!-- Contenedor 5 con dos contenedores internos -->
      <div class="contenedor-grande">
        <div class="fila2">
        <button class="contenedor-pequeño" >Cargando...</button>
        <button class="contenedor-pequeño" >Cargando...</button>
        <button class="contenedor-pequeño" >Cargando...</button>
        <button class="contenedor-pequeño" >Cargando...</button>
      </div>
        <h1>LEADS</h1>
          <div class="contenedor-interno">
             <table id="datos-tabla">
                <thead>
                    <tr>
                        <th>Fuente</th>
                        <th>Enero</th>
                        <th>Abril</th>
                        <th>Julio</th>
                        <th>Septiembre</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table> 
          </div>
          <div class="contenedor-interno">
            <div id="contenedor-barras">Cargando...</div>
          </div>
          
      </div>

      <!-- Contenedor 6 con dos contenedores uno encima del otro -->
      <div class="contenedor-grande">
          <div class="contenedor-interno">
            <div id="grafico">Cargando...</div>
          </div>
          <div class="contenedor-interno2">
            <div id="graficoRosquilla1">Cargando...</div>
            <div id="graficoRosquilla2">Cargando...</div>
            <div id="graficoRosquilla3">Cargando...</div>
          </div>
      </div>
  </div>

</div>




    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
    <script src="https://kit.fontawesome.com/e267099c50.js" crossorigin="anonymous"></script>

    <script>
        let arrow = document.querySelectorAll(".arrow");
        arrow.forEach((arrowElement) => {
            arrowElement.addEventListener("click", (e) => {
                let arrowParent = e.target.parentElement.parentElement; // selecciona el padre principal de la flecha
                arrowParent.classList.toggle("showMenu");
            });
        });

        let sidebar = document.querySelector(".sidebar");
        let sidebarBtn = document.querySelector(".bx-menu");
        sidebarBtn.addEventListener("click", () => {
            sidebar.classList.toggle("close");
        });

  //--------------------------------------------------------------------------------------------------------------------------------------------------------
  //--------------------------------------------------------------------------------------------------------------------------------------------------------

        // URL del script
        document.addEventListener('DOMContentLoaded', () => {
    const url = 'https://script.google.com/macros/s/AKfycbwjSeUDaWCgFsqfDNzofny941snzXxKa3Dr-sQ16_jCXSP5cbZ66Z6w_LyQwQKSCCwC/exec';

    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            mostrarDatos(data.slice(0, 3)); // Mostrar solo las primeras 5 filas
            mostrarBarrasProgreso(data); // Mostrar las barras de progreso
            mostrarGrafico(data.slice(5, 18)); // Mostrar el gráfico
            mostrarGraficosRosquilla(data.slice(29, 32));
            mostrarUltimosDatos(data);
            console.log(data);
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
        });
});

// Responsividad: Ajustar tamaños según el ancho de pantalla
const screenWidth = window.innerWidth;
const fontSize = screenWidth < 768 ? 7 : 17;
const barWidth = screenWidth < 768 ? 20 : 20;
const labelFontSize = screenWidth < 768 ? 10 : 15;
const widthLine = screenWidth < 768 ? 2 : 6;
const chartTitleFontSize = screenWidth < 768 ? 0 : 12;
const chartLegendFontSize = screenWidth < 768 ? 10 : 10;
const chartLabelFontSize = screenWidth < 768 ? 10 : 10;
const chartBarItemWidth = screenWidth < 768 ? 7 : 20;
const labelFontSizeRosquilla= screenWidth < 768 ? 10 : 15;
const FontSizeRosquilla= screenWidth < 768 ? 10 : 16;

//--------------------------------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------------------------------

function mostrarUltimosDatos(data) {
    const ultimosDatos = data.slice(-4); // Obtener las 4 últimas filas
    console.log("últimos datos", ultimosDatos);

    const botones = document.querySelectorAll('.contenedor-pequeño');
    botones.forEach(boton => {
        boton.innerHTML = ''; // Usar innerHTML para poder agregar <br>
    });

    ultimosDatos.forEach((fuenteDatos) => {
        if (fuenteDatos) {
            const meses = ['ENERO', 'ABRIL', 'JULIO', 'SEPTIEMBRE'];
            meses.forEach((mes, mesIndex) => {
                const boton = botones[mesIndex];
                if (boton) {
                    if (fuenteDatos.FUENTE) {
                        if (boton.innerHTML === '') {
                            boton.innerHTML += `${mes}<br><br>`; // Agregar el nombre del mes una vez
                        }

                        let valor = fuenteDatos[mes];
                        if (fuenteDatos.FUENTE === 'CAC') {
                            valor = `$${Math.round(valor)}`;
                        } else if (fuenteDatos.FUENTE === 'CPL Tibio' || fuenteDatos.FUENTE === 'CPL Frio') {
                            valor = `$${valor.toFixed(2)}`;
                        } else {
                            valor = valor.toFixed(2);
                        }

                        boton.innerHTML += `${fuenteDatos.FUENTE} ${valor}<br>`;
                    }
                } else {
                    console.error(`Botón para ${mes} no encontrado`);
                }
            });
        }
    });
}

//--------------------------------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------------------------------

function mostrarDatos(data) {
    const tablaCuerpo = document.querySelector('#datos-tabla tbody');
    tablaCuerpo.innerHTML = ''; // Limpia la tabla antes de agregar nuevas filas

    data.forEach(item => {
        const fila = document.createElement('tr');
        const eneroPorcentaje = item.ENERO && item.ENERO < 1 ? (item.ENERO * 100).toFixed(2) + '%' : item.ENERO;
        const abrilPorcentaje = item.ABRIL && item.ABRIL < 1 ? (item.ABRIL * 100).toFixed(2) + '%' : item.ABRIL;
        const julioPorcentaje = item.JULIO && item.JULIO < 1 ? (item.JULIO * 100).toFixed(2) + '%' : item.JULIO;
        const septiembrePorcentaje = item.SEPTIEMBRE && item.SEPTIEMBRE < 1 ? (item.SEPTIEMBRE * 100).toFixed(2) + '%' : item.SEPTIEMBRE;

        fila.innerHTML = `
            <td>${item.FUENTE}</td>
            <td>${eneroPorcentaje}</td>
            <td>${abrilPorcentaje}</td>
            <td>${julioPorcentaje}</td>
            <td>${septiembrePorcentaje}</td>
        `;

        tablaCuerpo.appendChild(fila);
    });
}

//--------------------------------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------------------------------

const solidColors = ['#ff32c8', '#6657ff', '#3ab1f5', '#67f213'];
const solidColors2 = ['#e17080', '#b745fd', '#38e3bf', '#a8ed20'];

function mostrarBarrasProgreso(data) {
    const contenedor = document.querySelector('#contenedor-barras');
    contenedor.innerHTML = ''; // Limpiar cualquier contenido previo

    const meses = ['ENERO', 'ABRIL', 'JULIO', 'SEPTIEMBRE'];
    const leadsTotales = data[0];
    const leadsFrios = data[1];
    const leadsTibios = data[2];

    meses.forEach((mes, i) => {
        const total = leadsTotales[mes];
        const frio = leadsFrios[mes];
        const tibio = leadsTibios[mes];

        const porcentajeFrio = ((frio / total) * 100).toFixed(2);
        const porcentajeTibio = ((tibio / total) * 100).toFixed(2);

        const fila = document.createElement('div');
        fila.classList.add('fila-mes');

        fila.innerHTML = `
            <div class="columna-mes">${mes}</div>
            <div class="columna-barra">
                <div class="barra-contenedor">
                    <div class="barra-frio" style="width: ${porcentajeFrio}%; background-color: ${solidColors[i]};">
                        <span class="texto-barra">Frío ${porcentajeFrio}%</span>
                    </div>
                    <div class="barra-tibio" style="width: ${porcentajeTibio}%;  background-color: ${solidColors2[i]};">
                        <span class="texto-barra">Tibio ${porcentajeTibio}%</span>
                    </div>
                </div>
            </div>
            <div class="columna-total">${total}</div>
        `;
        contenedor.appendChild(fila);
    });
}

//--------------------------------------------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------------------------------------------

function mostrarGrafico(data) {
    const meses = ['ENERO', 'ABRIL', 'JULIO', 'SEPTIEMBRE'];
    const clases = ['Clase 1', 'Clase 2', 'Clase 3', 'Clase 4', 'Clase 5', 'Clase 6'];

    const seriesData = clases.map(clase => {
        const asistencia = data.filter(row => row.FUENTE.includes(clase));
        return meses.map(mes => {
            const found = asistencia.find(a => a[mes] !== undefined);
            return found ? found[mes] : 0;
        });
    });

    const chartDom = document.getElementById('grafico');
    const myChart = echarts.init(chartDom);

    const colorGradients = [
        ['#ff32c8', '#e17080'], // ENERO
        ['#6657ff', '#b745fd'], // ABRIL
        ['#3ab1f5', '#38e3bf'], // JULIO
        ['#67f213', '#a8ed20 '] // SEPTIEMBRE
    ];

    const option = {
        title: {
            text: 'ASISTENCIA POR CLASE',
            left: 'center',
            top: '5px',
            textStyle: {
                fontSize: chartTitleFontSize, // Tamaño ajustable
                color: 'white'
            }
        },
        tooltip: {
            trigger: 'item',
            formatter: function (params) {
                return `${params.seriesName}<br/>${params.name}: ${params.value}`;
            }
        },
        legend: {
            data: clases,
            bottom: '10%',
            textStyle: {
                fontSize: chartTitleFontSize, // Tamaño ajustable
                color: 'white'
            }
        },
        xAxis: {
            data: clases,
            axisLabel: {
                fontSize: labelFontSize, // Tamaño ajustable
                color: 'white'
            }
        },
        yAxis: {
            axisLabel: {
                fontSize: labelFontSize, // Tamaño ajustable
                color: 'white'
            },
            splitLine: {
                lineStyle: {
                    type: 'dashed',
                    color: '#333'
                }
            }
        },
        series: meses.map((mes, index) => ({
            name: mes,
            type: 'bar',
            data: seriesData.map(series => series[index]),
            itemStyle: {
                borderRadius: [5, 5, 0, 0],
                shadowBlur: 10,
                // Aplicar un degradado de color a cada barra
                color: {
                    type: 'linear',
                    x: 0,
                    y: 0,
                    x2: 0,
                    y2: 1,
                    colorStops: [
                        { offset: 0, color: colorGradients[index][0] }, // Color superior
                        { offset: 1, color: colorGradients[index][1] }  // Color inferior
                    ],
                    global: false // Usar valores de color locales
                }
            },
            label: {
                show: true,
                position: 'inside', // Posicionar las etiquetas dentro de la barra
                formatter: '{c}', // Mostrar el valor
                fontWeight: 'bold',
                color: '#08112c', // Color de la etiqueta
                fontSize: chartTitleFontSize, // Tamaño de la fuente de la etiqueta
                rotate: 90 // Rotar la etiqueta verticalmente
            },
            barWidth: chartBarItemWidth  // Ancho ajustable
        }))
    };

    option && myChart.setOption(option);
}



  //--------------------------------------------------------------------------------------------------------------------------------------
  //--------------------------------------------------------------------------------------------------------------------------------------


const colorGradients = [
    ['#ff32c8', '#e17080'], // Degradado para ENERO - más claro
    ['#6657ff', '#b745fd'], // Degradado para ABRIL - más claro
    ['#3ab1f5', '#38e3bf'], // Degradado para JULIO - más claro
    ['#67f213', '#a8ed20 '], // Degradado para SEPTIEMBRE - más claro
];
function mostrarGraficosRosquilla(data) {
    console.log("rosquilla" + data);
    const meses = ['ENERO', 'ABRIL', 'JULIO', 'SEPTIEMBRE'];

    // Para cada gráfico de facturación (facturación, contado y crédito)
    const graficos = ['Facturación Total', 'Facturación Contado', 'Facturación Crédito'];

    // Recorrer cada categoría de facturación
    data.forEach((facturacion, index) => {
        const containerId = `graficoRosquilla${index + 1}`;
        const container = document.getElementById(containerId);
        if (container) {
            const valores = meses.map(mes => facturacion[mes]);

            // Inicializar ECharts para el gráfico de rosquilla
            const chart = echarts.init(container);
            const option = {
                title: {
                    text: graficos[index],
                    left: 'center',
                    top: '35px',
                    textStyle: {
                        fontSize: FontSizeRosquilla,
                        color: 'white'
                    }
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b}: {c} ({d}%)'
                },
                legend: {
                    bottom: '1%',
                    textStyle: {
                        fontSize: labelFontSizeRosquilla,
                        color: 'white'
                    }
                },
                series: [{
                    name: graficos[index],
                    type: 'pie',
                    radius: ['30%', '70%'], // Radio interno y externo para rosquilla
                    avoidLabelOverlap:false,
                    itemStyle: {
                        borderRadius: 5,
                        borderColor: '',
                        borderWidth: 2
                    },
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 'labelFontSizeRosquilla',
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: {
                        show: false
                    },
                    data: meses.map((mes, i) => ({
                        value: valores[i],
                        name: mes,
                        itemStyle: {
                            color: {
                                type: 'linear',
                                x: 0,
                                y: 0,
                                x2: 1,
                                y2: 1,
                                colorStops: [
                                    { offset: 0, color: colorGradients[i][0] }, // Color inicial del degradado
                                    { offset: 1, color: colorGradients[i][1] }  // Color final del degradado
                                ]
                            }
                        }
                    }))
                }]
            };

            // Renderizar el gráfico
            chart.setOption(option);
        }
    });
}

    </script>
</body>
</html>
